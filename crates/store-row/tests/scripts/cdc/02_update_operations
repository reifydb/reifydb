# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Setup: Insert initial data
insert 1 a=1
insert 1 b=10
commit
---
ok

# Test update with before value tracked
update 2 a=2
commit
---
ok

cdc_get 2 1
---
Change { seq: 1, change: Update { key: "a", pre: "1", post: "2" } }

# Test another update
update 3 b=20
commit
---
ok

cdc_get 3 1
---
Change { seq: 1, change: Update { key: "b", pre: "10", post: "20" } }

# Test multiple updates to same key in different versions
update 4 a=3
commit
---
ok

cdc_get 4 1
---
Change { seq: 1, change: Update { key: "a", pre: "2", post: "3" } }

update 5 a=4
commit
---
ok

cdc_get 5 1
---
Change { seq: 1, change: Update { key: "a", pre: "3", post: "4" } }

# Test update with empty value
update 6 b=
commit
---
ok

cdc_get 6 1
---
Change { seq: 1, change: Update { key: "b", pre: "20", post: "" } }

# Test getting full transaction for update
cdc_get 6
---
Cdc { version: 6, ts: 1000, changes: [{ seq: 1, change: Update { key: "b", pre: "20", post: "" } }] }
