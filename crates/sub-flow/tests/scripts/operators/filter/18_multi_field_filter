# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test filter using multiple fields
# Complex conditions across different columns

(command 'create schema test;')
command 'create table test.source { id: int4, age: int4, salary: int8, department: utf8 }'
---
> +----------+----------+-----------+
> |  schema  |  table   |  created  |
> +----------+----------+-----------+
> |   test   |  source  |   true    |
> +----------+----------+-----------+
> 

command 'create deferred view test.senior_engineers { id: int4, age: int4, salary: int8, department: utf8 } as {
  from test.source
  filter { age >= 30 and salary > 100000 and department == "Engineering" }
}'
---
> +----------+--------------------+-----------+
> |  schema  |        view        |  created  |
> +----------+--------------------+-----------+
> |   test   |  senior_engineers  |   true    |
> +----------+--------------------+-----------+
> 

# Insert employee data
command 'from [
  {id: 1, age: 35, salary: 120000, department: "Engineering"},
  {id: 2, age: 28, salary: 110000, department: "Engineering"},
  {id: 3, age: 32, salary: 95000, department: "Engineering"},
  {id: 4, age: 40, salary: 130000, department: "Sales"},
  {id: 5, age: 45, salary: 150000, department: "Engineering"},
  {id: 6, age: 30, salary: 105000, department: "Engineering"}
] insert test.source'
---
> +----------+----------+------------+
> |  schema  |  table   |  inserted  |
> +----------+----------+------------+
> |   test   |  source  |     6      |
> +----------+----------+------------+
> 

command 'from test.source'
---
> +------+-------+----------+---------------+
> |  id  |  age  |  salary  |  department   |
> +------+-------+----------+---------------+
> |  6   |  30   |  105000  |  Engineering  |
> |  5   |  45   |  150000  |  Engineering  |
> |  4   |  40   |  130000  |     Sales     |
> |  3   |  32   |  95000   |  Engineering  |
> |  2   |  28   |  110000  |  Engineering  |
> |  1   |  35   |  120000  |  Engineering  |
> +------+-------+----------+---------------+
> 

await

# Should show senior engineers only
command 'from test.senior_engineers'
---
> +------+-------+----------+---------------+
> |  id  |  age  |  salary  |  department   |
> +------+-------+----------+---------------+
> |  6   |  30   |  105000  |  Engineering  |
> |  5   |  45   |  150000  |  Engineering  |
> |  1   |  35   |  120000  |  Engineering  |
> +------+-------+----------+---------------+
> 
