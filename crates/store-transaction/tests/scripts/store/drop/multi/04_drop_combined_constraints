# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Tests combined up_to_version AND keep_last_versions constraints.
# Uses AND logic: drop only if BOTH constraints agree.

# Insert versions: 1,5,10,20,100
set a=v1 version=1
set a=v5 version=5
set a=v10 version=10
set a=v20 version=20
set a=v100 version=100
---
ok

# up_to_version=15 would drop v1,5,10 (all < 15)
# keep_last_versions=3 protects v100,20,10 (top 3)
# Combined (AND): only drop v1,5 (v10 is protected by keep_last)
drop a up_to_version=15 keep_last_versions=3
---
ok

get a version=1
get a version=5
get a version=10
get a version=20
get a version=100
---
"a" => None
"a" => None
"a" => "v10"
"a" => "v20"
"a" => "v100"
