# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Tests that an update moves the old version to historical.
# When updating a key, the old version becomes historical.

# Insert initial value
# Key "a" = 1 byte, versioned = 9 bytes (1 + 8), value "1" = 1 byte
set a=1
---
ok

stats_current
---
current_count: 1
current_key_bytes: 11
current_value_bytes: 1

stats_historical
---
historical_count: 0
historical_key_bytes: 0
historical_value_bytes: 0

# Update the key
# New version becomes current, old version moves to historical
set a=2
---
ok

# Current should still have 1 entry (the new version)
stats_current
---
current_count: 1
current_key_bytes: 11
current_value_bytes: 1

# Historical should now have 1 entry (the old version)
stats_historical
---
historical_count: 1
historical_key_bytes: 11
historical_value_bytes: 1
