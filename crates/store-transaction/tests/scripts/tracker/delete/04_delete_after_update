# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Tests delete after multiple updates.
# Historical should accumulate all versions plus the tombstone.

# Insert initial value
set a=1
---
ok

stats
---
current_count: 1
current_key_bytes: 11
current_value_bytes: 1
historical_count: 0
historical_key_bytes: 0
historical_value_bytes: 0
cdc_count: 1
cdc_key_bytes: 1
cdc_value_bytes: 76
total_bytes: 12

# First update - adds to historical
set a=2
---
ok

stats_historical
---
historical_count: 1
historical_key_bytes: 11
historical_value_bytes: 1

# Second update - adds to historical
set a=3
---
ok

stats_historical
---
historical_count: 2
historical_key_bytes: 22
historical_value_bytes: 2

# Delete - moves current to historical and adds tombstone
remove a
---
ok

# Current should be empty
stats_current
---
current_count: 0
current_key_bytes: 0
current_value_bytes: 0

# Historical should have:
# - Version 1: versioned_key=9, value=1 (from first update)
# - Version 2: versioned_key=9, value=1 (from second update)
# - Version 3: versioned_key=9, value=1 (from delete moving current to historical)
# - Tombstone: versioned_key=9, value=0
stats_historical
---
historical_count: 4
historical_key_bytes: 44
historical_value_bytes: 3
