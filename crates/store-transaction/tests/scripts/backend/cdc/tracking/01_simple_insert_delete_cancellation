# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test that a simple insert+delete in the same transaction
# results in complete cancellation with no CDC entries

# Single insert+delete cancellation
insert 1 key_a=value1
delete 1 key_a
commit
---
ok

# Verify no CDC changes generated
cdc_get 1
---
None

cdc_count 1
---
count: 0

# Add another operation to verify sequence numbering
insert 2 key_b=value2
delete 2 key_b
insert 2 key_c=value3
commit
---
ok

# Only key_c should appear with sequence 1
cdc_get 2 1
---
Change { seq: 1, change: Insert { key: "key_c", post: "value3" } }

cdc_get 2 2
---
None

cdc_count 2
---
count: 1
