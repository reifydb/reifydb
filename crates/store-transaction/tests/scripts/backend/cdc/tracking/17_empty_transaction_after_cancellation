# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test that transactions with only cancelled operations
# result in empty CDC (no entries)

# Transaction with single cancelled operation
insert 1 cancel_only=value
delete 1 cancel_only
commit
---
ok

cdc_get 1
---
None

cdc_count 1
---
count: 0

# Transaction with multiple cancelled operations
insert 2 cancel1=v1
delete 2 cancel1
insert 2 cancel2=v2
delete 2 cancel2
insert 2 cancel3=v3
delete 2 cancel3
commit
---
ok

cdc_count 2
---
count: 0

# Complex cancellations all cancel out
insert 3 c1=x
update 3 c1=y
delete 3 c1
insert 3 c2=a
update 3 c2=b
update 3 c2=c
delete 3 c2
commit
---
ok

cdc_count 3
---
count: 0

# Update non-existent then delete (should cancel)
update 4 never_existed=temp
delete 4 never_existed
commit
---
ok

cdc_count 4
---
count: 0

# Mix that results in empty
insert 5 a=1
delete 5 a
insert 5 b=2
delete 5 b
update 5 c=3
delete 5 c
commit
---
ok

cdc_count 5
---
count: 0
