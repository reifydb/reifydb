# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test Insert CDC event generation
insert 1 a=1
---
ok

cdc_get 1 1
---
CdcEvent { version: 1, seq: 1, ts: 1000, change: Insert { key: "a", after: "1" } }

# Test Update CDC event generation (with before value)
update 2 a=2
---
ok

cdc_get 2 1
---
CdcEvent { version: 2, seq: 1, ts: 1000, change: Update { key: "a", before: "1", after: "2" } }

# Test Delete CDC event generation
delete 3 a
---
ok

cdc_get 3 1
---
CdcEvent { version: 3, seq: 1, ts: 1000, change: Delete { key: "a", before: "2" } }

# Test Insert on new key
insert 4 b=10
---
ok

cdc_get 4 1
---
CdcEvent { version: 4, seq: 1, ts: 1000, change: Insert { key: "b", after: "10" } }

# Test multiple operations in same version
insert 5 c=100
---
ok

update 5 b=20
---
ok

cdc_get 5 1
---
CdcEvent { version: 5, seq: 1, ts: 1000, change: Insert { key: "c", after: "100" } }

cdc_get 5 2
---
CdcEvent { version: 5, seq: 2, ts: 1000, change: Update { key: "b", before: "10", after: "20" } }
