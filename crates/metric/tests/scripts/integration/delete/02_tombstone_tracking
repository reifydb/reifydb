# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Tests that tombstones are counted in historical.
# A tombstone has key bytes but 0 value bytes.

# Insert and delete a key with a larger value
# Key "test" = 4 bytes, versioned = 12 bytes (4 + 8)
# Value "largevalue" = 10 bytes
set test=largevalue
---
ok

stats_current
---
current_count: 1
current_key_bytes: 14
current_value_bytes: 10

# Delete the key
remove test
---
ok

# Historical should have:
# - Old value: versioned_key=12, value=10
# - Tombstone: versioned_key=12, value=0
stats_historical
---
historical_count: 2
historical_key_bytes: 28
historical_value_bytes: 10

# Totals should reflect the tombstone has 0 value bytes
stats_totals
---
total_count: 2
current_bytes: 0
historical_bytes: 38
total_bytes: 38
