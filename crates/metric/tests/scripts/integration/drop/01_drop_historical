# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Tests that drop reduces historical counts.
# Drop physically removes entries, unlike delete which creates tombstones.

# Create versions by updating
set a=1 version=1
---
ok

set a=2 version=2
---
ok

set a=3 version=3
---
ok

# Current has latest, historical has older versions
stats_current
---
current_count: 1
current_key_bytes: 11
current_value_bytes: 1

stats_historical
---
historical_count: 2
historical_key_bytes: 22
historical_value_bytes: 2

# Drop old versions, keep only latest
drop a keep_last_versions=1 version=4
---
ok

# Current should be unchanged
stats_current
---
current_count: 1
current_key_bytes: 11
current_value_bytes: 1

# Historical should be reduced to 0 (both old versions dropped)
stats_historical
---
historical_count: 0
historical_key_bytes: 0
historical_value_bytes: 0
