# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test mapping the same column multiple times
# With different transformations

(command 'create schema test;')
command 'create table test.source { 
  id: int4,
  value: int4
}'
---
> +----------+----------+-----------+
> |  schema  |  table   |  created  |
> +----------+----------+-----------+
> |   test   |  source  |   true    |
> +----------+----------+-----------+
> 

command 'create deferred view test.duplicated { 
  id: int4,
  original: int4,
  doubled: int4,
  squared: int4,
  negative: int4,
  mod_three: int4
} with {
  from test.source
  map { 
    id,
    value as original,
    value * 2 as doubled,
    value * value as squared,
    0 - value as negative,
    value % 3 as mod_three
  }
}'
---
> +----------+--------------+-----------+
> |  schema  |     view     |  created  |
> +----------+--------------+-----------+
> |   test   |  duplicated  |   true    |
> +----------+--------------+-----------+
> 

# Insert test data
command 'from [
  {id: 1, value: 7},
  {id: 2, value: 10},
  {id: 3, value: 3},
  {id: 4, value: 15}
] insert test.source'
---
> +----------+----------+------------+
> |  schema  |  table   |  inserted  |
> +----------+----------+------------+
> |   test   |  source  |     4      |
> +----------+----------+------------+
> 

await

# Should show same column with different transformations
command 'from test.duplicated'
---
> +------+------------+-----------+-----------+------------+-------------+
> |  id  |  original  |  doubled  |  squared  |  negative  |  mod_three  |
> +------+------------+-----------+-----------+------------+-------------+
> |  4   |     15     |    30     |    225    |    -15     |      0      |
> |  3   |     3      |     6     |     9     |     -3     |      0      |
> |  2   |     10     |    20     |    100    |    -10     |      1      |
> |  1   |     7      |    14     |    49     |     -7     |      1      |
> +------+------------+-----------+-----------+------------+-------------+
> 
