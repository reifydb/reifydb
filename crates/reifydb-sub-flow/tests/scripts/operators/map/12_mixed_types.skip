# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test map with mixed data types
# Integer, float, string, boolean types

(command 'create schema test;')
command 'create table test.source { 
  id: int4, 
  age: int4,
  height: float8,
  name: utf8,
  active: bool
}'
---
> +----------+----------+-----------+
> |  schema  |  table   |  created  |
> +----------+----------+-----------+
> |   test   |  source  |   true    |
> +----------+----------+-----------+
> 

command 'create deferred view test.mixed { 
  person_id: int4,
  age_next_year: int4,
  height_cm: float8,
  greeting: utf8,
  is_adult: bool
} with {
  from test.source
  map { 
    id as person_id,
    age + 1 as age_next_year,
    height * 100.0 as height_cm,
    "Hello, " + name as greeting,
    age >= 18 as is_adult
  }
}'
---
> +----------+---------+-----------+
> |  schema  |  view   |  created  |
> +----------+---------+-----------+
> |   test   |  mixed  |   true    |
> +----------+---------+-----------+
> 

# Insert test data
command 'from [
  {id: 1, age: 25, height: 1.75, name: "Alice", active: true},
  {id: 2, age: 17, height: 1.68, name: "Bob", active: false},
  {id: 3, age: 30, height: 1.82, name: "Charlie", active: true}
] insert test.source'
---
> +----------+----------+------------+
> |  schema  |  table   |  inserted  |
> +----------+----------+------------+
> |   test   |  source  |     3      |
> +----------+----------+------------+
> 

await

# Should show mixed type transformations
command 'from test.mixed'
---
> +-------------+-----------------+-------------+------------------+------------+
> |  person_id  |  age_next_year  |  height_cm  |    greeting      |  is_adult  |
> +-------------+-----------------+-------------+------------------+------------+
> |      3      |       31        |    182.0    |  Hello, Charlie  |    true    |
> |      2      |       18        |    168.0    |  Hello, Bob      |   false    |
> |      1      |       26        |    175.0    |  Hello, Alice    |    true    |
> +-------------+-----------------+-------------+------------------+------------+
> 