# SPDX-License-Identifier: AGPL-3.0-or-later
# Copyright (c) 2025 ReifyDB

# Test AGGREGATE with multiple group-by columns
parse 'FROM sales | AGGREGATE { total: sum(amount) } BY { region, year }'
---
> Program
> `-- [0] Pipeline
>     +-- [0] From(sales)
>     `-- [1] Aggregate
>         +-- group_by:
>         |   +-- [0] Identifier(region)
>         |   `-- [1] Identifier(year)
>         `-- aggregations:
>             `-- [0] Binary(KeyValue)
>                 +-- left: Identifier(total)
>                 `-- right: Call(sum)
>                     `-- args:
>                         `-- [0] Identifier(amount)
>

# Test AGGREGATE with three group-by columns
parse 'FROM orders | AGGREGATE { count: count(id) } BY { customer_id, product_id, status }'
---
> Program
> `-- [0] Pipeline
>     +-- [0] From(orders)
>     `-- [1] Aggregate
>         +-- group_by:
>         |   +-- [0] Identifier(customer_id)
>         |   +-- [1] Identifier(product_id)
>         |   `-- [2] Identifier(status)
>         `-- aggregations:
>             `-- [0] Binary(KeyValue)
>                 +-- left: Identifier(count)
>                 `-- right: Call(count)
>                     `-- args:
>                         `-- [0] Identifier(id)
>

# Test multiple aggregations with multiple group-by columns
parse 'FROM transactions | AGGREGATE { min_amt: min(amount), max_amt: max(amount) } BY { account_id, year, month }'
---
> Program
> `-- [0] Pipeline
>     +-- [0] From(transactions)
>     `-- [1] Aggregate
>         +-- group_by:
>         |   +-- [0] Identifier(account_id)
>         |   +-- [1] Identifier(year)
>         |   `-- [2] Identifier(month)
>         `-- aggregations:
>             +-- [0] Binary(KeyValue)
>             |   +-- left: Identifier(min_amt)
>             |   `-- right: Call(min)
>             |       `-- args:
>             |           `-- [0] Identifier(amount)
>             `-- [1] Binary(KeyValue)
>                 +-- left: Identifier(max_amt)
>                 `-- right: Call(max)
>                     `-- args:
>                         `-- [0] Identifier(amount)
>
