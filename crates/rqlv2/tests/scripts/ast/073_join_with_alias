# SPDX-License-Identifier: AGPL-3.0-or-later
# Copyright (c) 2025 ReifyDB

# Test join alias referencing in USING clause
parse 'LEFT JOIN { FROM customers } AS c USING (id, c.customer_id)'
---
> Program
> `-- [0] Expression
>     `-- Join(Left)
>         +-- subquery:
>         |   `-- SubQuery
>         |       `-- [0] From(customers)
>         +-- alias: c
>         `-- using:
>             `-- [0] Pair
>                 +-- left: Identifier(id)
>                 `-- right: Binary(Dot)
>                     +-- left: Identifier(c)
>                     `-- right: Identifier(customer_id)
>

# Test join alias in complex pipeline
parse 'FROM orders | LEFT JOIN { FROM products } AS p USING (product_id, p.id) | FILTER p.price > 100'
---
> Program
> `-- [0] Pipeline
>     +-- [0] From(orders)
>     +-- [1] Join(Left)
>     |   +-- subquery:
>     |   |   `-- SubQuery
>     |   |       `-- [0] From(products)
>     |   +-- alias: p
>     |   `-- using:
>     |       `-- [0] Pair
>     |           +-- left: Identifier(product_id)
>     |           `-- right: Binary(Dot)
>     |               +-- left: Identifier(p)
>     |               `-- right: Identifier(id)
>     `-- [2] Filter
>         `-- Binary(Gt)
>             +-- left: Binary(Dot)
>             |   +-- left: Identifier(p)
>             |   `-- right: Identifier(price)
>             `-- right: Integer(100)
>

# Test multiple joins with different aliases
parse 'FROM orders | LEFT JOIN { FROM customers } AS c USING (customer_id, c.id) | LEFT JOIN { FROM products } AS p USING (product_id, p.id)'
---
> Program
> `-- [0] Pipeline
>     +-- [0] From(orders)
>     +-- [1] Join(Left)
>     |   +-- subquery:
>     |   |   `-- SubQuery
>     |   |       `-- [0] From(customers)
>     |   +-- alias: c
>     |   `-- using:
>     |       `-- [0] Pair
>     |           +-- left: Identifier(customer_id)
>     |           `-- right: Binary(Dot)
>     |               +-- left: Identifier(c)
>     |               `-- right: Identifier(id)
>     `-- [2] Join(Left)
>         +-- subquery:
>         |   `-- SubQuery
>         |       `-- [0] From(products)
>         +-- alias: p
>         `-- using:
>             `-- [0] Pair
>                 +-- left: Identifier(product_id)
>                 `-- right: Binary(Dot)
>                     +-- left: Identifier(p)
>                     `-- right: Identifier(id)
>
