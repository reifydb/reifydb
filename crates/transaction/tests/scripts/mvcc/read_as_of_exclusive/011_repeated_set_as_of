# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Test calling set_as_of_exclusive multiple times on same transaction

import a=1
---
ok

t1: begin
t1: set a=2
t1: commit
---
ok

t2: begin
t2: set a=3
t2: commit
---
ok

t3: begin
t3: set a=4
t3: commit
---
ok

# Start transaction and repeatedly change version
t4: begin
t4: get a
---
t4: "a" => "4"

# First set_as_of_exclusive
t4: set_as_of_exclusive 1
t4: get a
---
t4: "a" => None

# Change again
t4: set_as_of_exclusive 3
t4: get a
---
t4: "a" => "2"

# And again
t4: set_as_of_exclusive 2
t4: get a
---
t4: "a" => "1"

# Back to latest
t4: set_as_of_exclusive 4
t4: get a
---
t4: "a" => "3"

# Multiple times to same version
t4: set_as_of_exclusive 2
t4: set_as_of_exclusive 2
t4: set_as_of_exclusive 2
t4: get a
---
t4: "a" => "1"
