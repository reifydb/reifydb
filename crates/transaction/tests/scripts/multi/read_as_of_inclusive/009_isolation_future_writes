# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

# Verify transaction doesn't see uncommitted changes

import a=1 b=2
---
ok

# Make a committed change
t1: begin
t1: set a=10
t1: commit
---
ok

# Start an uncommitted transaction
t2: begin
t2: set b=20 c=30
---
ok

# Transaction at version 2 should see committed but not uncommitted
t3: begin
t3: set_as_of_inclusive 2
t3: get a b c
---
t3: "a" => "10"
t3: "b" => "2"
t3: "c" => None

# Transaction at version 1 should not see any changes
t4: begin
t4: set_as_of_inclusive 1
t4: get a b c
---
t4: "a" => "1"
t4: "b" => "2"
t4: "c" => None

# Commit t2
t2: commit
---
ok

# t3 and t4 should still see their respective versions
t3: get a b c
---
t3: "a" => "10"
t3: "b" => "2"
t3: "c" => None

t4: get a b c
---
t4: "a" => "1"
t4: "b" => "2"
t4: "c" => None
