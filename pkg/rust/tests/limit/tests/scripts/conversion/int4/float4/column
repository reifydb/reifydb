# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

(admin 'create namespace test')

(admin 'create table test.conversion{col: int4}')
(command 'INSERT test.conversion [{ col: 0 }]')
command 'from test.conversion map {cast(col, float4)}'
---
> +----------+-------+
> |  rownum  |  col  |
> +----------+-------+
> |    1     |   0   |
> +----------+-------+
>


(command 'INSERT test.conversion [{ col: 16777216 }]')
command 'from test.conversion map {cast(col, float4)}'
---
> +----------+------------+
> |  rownum  |    col     |
> +----------+------------+
> |    2     |  16777216  |
> |    1     |     0      |
> +----------+------------+
>

(command 'INSERT test.conversion [{ col: -16777216 }]')
command 'from test.conversion map {cast(col, float4)}'
---
> +----------+-------------+
> |  rownum  |     col     |
> +----------+-------------+
> |    3     |  -16777216  |
> |    2     |  16777216   |
> |    1     |      0      |
> +----------+-------------+
>

(admin 'create table test.conversion_fail{col: int4}')
(command 'INSERT test.conversion_fail [{ col: 16777217 }]')
!command 'from test.conversion_fail map {cast(col, float4)}'
---
>  Error CAST_002: failed to cast to Float4
>   at "(colfloat4" (line 1, column 36)
>
>   1 │ from test.conversion_fail map {cast(col, float4)}
>     │                                     ~~~~~~~~~~
>     │                              failed to cast to Float4
>
>   ↳  Error NUMBER_004: too large for precise float conversion
>     at "col" (line 1, column 37)
>
>     1 │ from test.conversion_fail map {cast(col, float4)}
>       │                                     ~~~
>       │          converting 'col' from Int4 to Float4 would lose precision
>
>     note: Float4 can only represent from -16_777_216 (-2^24) to 16_777_216 (2^24) precisely
>     note: consider using a different numeric type if exact precision is required
>

(command 'INSERT test.conversion_fail [{ col: -16777217 }]')
!command 'from test.conversion_fail map {cast(col, float4)}'
---
>  Error CAST_002: failed to cast to Float4
>   at "(colfloat4" (line 1, column 36)
>
>   1 │ from test.conversion_fail map {cast(col, float4)}
>     │                                     ~~~~~~~~~~
>     │                              failed to cast to Float4
>
>   ↳  Error NUMBER_004: too large for precise float conversion
>     at "col" (line 1, column 37)
>
>     1 │ from test.conversion_fail map {cast(col, float4)}
>       │                                     ~~~
>       │          converting 'col' from Int4 to Float4 would lose precision
>
>     note: Float4 can only represent from -16_777_216 (-2^24) to 16_777_216 (2^24) precisely
>     note: consider using a different numeric type if exact precision is required
>
