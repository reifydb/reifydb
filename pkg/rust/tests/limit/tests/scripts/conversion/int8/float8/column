# Copyright (c) reifydb.com 2025
# This file is licensed under the AGPL-3.0-or-later, see license.md file

(admin 'create namespace test')

(admin 'create table test.conversion{col: int8}')
(command 'INSERT test.conversion [{ col: 0 }]')
command 'from test.conversion map {cast(col, float8)}'
---
> +----------+-------+
> |  rownum  |  col  |
> +----------+-------+
> |    1     |   0   |
> +----------+-------+
>


(command 'INSERT test.conversion [{ col: 9007199254740992 }]')
command 'from test.conversion map {cast(col, float8)}'
---
> +----------+--------------------+
> |  rownum  |        col         |
> +----------+--------------------+
> |    2     |  9007199254740992  |
> |    1     |         0          |
> +----------+--------------------+
>

(command 'INSERT test.conversion [{ col: -9007199254740992 }]')
command 'from test.conversion map {cast(col, float8)}'
---
> +----------+---------------------+
> |  rownum  |         col         |
> +----------+---------------------+
> |    3     |  -9007199254740992  |
> |    2     |  9007199254740992   |
> |    1     |          0          |
> +----------+---------------------+
>

(command 'INSERT test.conversion [{ col: 9007199254740993 }]')
!command 'from test.conversion map {cast(col, float8)}'
---
>  Error CAST_002: failed to cast to Float8
>   at "col" (line 1, column 32)
>
>   1 │ from test.conversion map {cast(col, float8)}
>     │                                ~~~
>     │                     failed to cast to Float8
>
>   ↳  Error NUMBER_004: too large for precise float conversion
>     at "col" (line 1, column 32)
>
>     1 │ from test.conversion map {cast(col, float8)}
>       │                                ~~~
>       │     converting 'col' from Int8 to Float8 would lose precision
>
>     note: Float8 can only represent from -9_007_199_254_740_992 (-2^53) to 9_007_199_254_740_992 (2^53) precisely
>     note: consider using a different numeric type if exact precision is required
>
